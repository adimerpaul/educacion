import{Q as h}from"./QMarkupTable.13120e8c.js";import{_ as P,O as r,P as u,Q as s,R as a,aA as c,T as n,Y as g,Z as x,$ as b,az as v,S as d,ay as V,U as m,J as _,V as Q,W as y,aB as A}from"./index.97c990ed.js";import{d as B,e as k,f as p,g as w}from"./format.eb45db8a.js";import{Q as S}from"./QBtnDropdown.e381bf58.js";import{h as G,Q as C,a as N,b as z}from"./moment.ccc0429a.js";import{Q as E,a as I}from"./QForm.bd1efe33.js";import{Q as U}from"./QPage.e2342141.js";import{C as D}from"./ClosePopup.893ca764.js";const Y={name:"AlmacenPage",data(){return{poas:[],poa:{},poaDialog:!1,loading:!1,actionPeriodo:"",peridosActivos:[],filter:"",columns:[{name:"actions",label:"Acciones",align:"center"},{name:"fecha",label:"Fecha",align:"center",field:e=>G(e.fecha).format("DD/MM/YYYY")},{name:"estado",label:"Estado",align:"center",field:e=>e.estado},{name:"periodo",label:"Periodo",align:"center",field:e=>{var o;return(o=e.periodo)==null?void 0:o.periodo}},{name:"area",label:"Area",align:"center",field:e=>{var o;return(o=e.area)==null?void 0:o.nombre}},{name:"user",label:"Usuario",align:"center",field:e=>{var o;return(o=e.user)==null?void 0:o.name}}]}},mounted(){this.poasGet(),this.periodosActivos()},methods:{print(e){const o=this.$url+"formulario1/"+e.id;window.open(o,"_blank")},periodosActivos(){this.$axios.get("periodos/activos").then(e=>{this.peridosActivos=e.data}).catch(e=>{this.$alert.error(e.response.data.message)})},poaNew(){this.poa={periodo_id:""},this.actionPeriodo="Nuevo",this.poaDialog=!0},poasGet(){this.loading=!0,this.$axios.get("poas").then(e=>{this.poas=e.data}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},poaPost(){this.loading=!0,this.$axios.post("poas",this.poa).then(e=>{this.poasGet(),this.poaDialog=!1,this.$alert.success("Periodo creado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},poaPut(){this.loading=!0,this.$axios.put("poas/"+this.poa.id,this.poa).then(e=>{this.poasGet(),this.poaDialog=!1,this.$alert.success("Periodo actualizado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},poaEdit(e){this.poa={...e},this.actionPeriodo="Editar",this.poaDialog=!0},poaVisible(e){this.$router.push({name:"poaVisible",params:{id:e.id}})},poaDelete(e){this.$alert.dialog("\xBFDesea eliminar el poa?").onOk(()=>{this.loading=!0,this.$axios.delete("poas/"+e).then(o=>{this.poasGet(),this.$alert.success("Periodo eliminado")}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})})}}},q={class:"row"},F={class:"col-12 col-md-6"},T={class:"text-right"};function L(e,o,O,$,i,t){return r(),u(U,{class:"q-pa-md"},{default:s(()=>[a(v,{flat:"",bordered:""},{default:s(()=>[a(c,{class:""},{default:s(()=>[n("div",q,[n("div",F,[o[6]||(o[6]=n("span",{class:"text-bold"},"Gestiones Activas:",-1)),(r(!0),g(b,null,x(i.peridosActivos,l=>(r(),g(b,{key:l.id},[a(h,{label:l.periodo,color:"positive",dense:"",size:"14px","text-color":"white"},null,8,["label"]),a(d,{icon:"print",flat:"",dense:"",onClick:f=>t.print(l),"no-caps":"",label:"Formulario 1"},null,8,["onClick"])],64))),128))])])]),_:1})]),_:1}),a(N,{rows:i.poas,columns:i.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Almacen",filter:i.filter},{"top-right":s(()=>[a(d,{color:"primary",label:"Crear poa",onClick:t.poaNew,"no-caps":"",icon:"add_circle_outline",loading:i.loading},null,8,["onClick","loading"]),a(V,{modelValue:i.filter,"onUpdate:modelValue":o[0]||(o[0]=l=>i.filter=l),label:"Buscar",dense:"",outlined:""},{append:s(()=>[a(m,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":s(l=>[a(C,{props:l},{default:s(()=>[a(S,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:s(()=>[a(B,null,{default:s(()=>[_((r(),u(k,{clickable:"",onClick:f=>t.poaVisible(l.row)},{default:s(()=>[a(p,{avatar:""},{default:s(()=>[a(m,{name:"visibility"})]),_:1}),a(p,null,{default:s(()=>[a(w,null,{default:s(()=>o[7]||(o[7]=[Q("Administrar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[D]]),_((r(),u(k,{clickable:"",onClick:f=>t.poaDelete(l.row.id)},{default:s(()=>[a(p,{avatar:""},{default:s(()=>[a(m,{name:"delete"})]),_:1}),a(p,null,{default:s(()=>[a(w,null,{default:s(()=>o[8]||(o[8]=[Q("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[D]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-estado":s(l=>[a(C,{props:l},{default:s(()=>[a(h,{label:l.row.estado,color:l.row.estado==="Abierto"?"positive":"red","text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),a(A,{modelValue:i.poaDialog,"onUpdate:modelValue":o[5]||(o[5]=l=>i.poaDialog=l),persistent:""},{default:s(()=>[a(v,null,{default:s(()=>[a(c,{class:"q-pb-none row items-center"},{default:s(()=>[n("div",null,y(i.actionPeriodo)+" poa ",1),a(E),a(d,{icon:"close",flat:"",round:"",dense:"",onClick:o[1]||(o[1]=l=>i.poaDialog=!1)})]),_:1}),a(c,{class:"q-pt-none"},{default:s(()=>[a(I,{onSubmit:o[4]||(o[4]=l=>i.poa.id?t.poaPut():t.poaPost())},{default:s(()=>[a(z,{modelValue:i.poa.periodo_id,"onUpdate:modelValue":o[2]||(o[2]=l=>i.poa.periodo_id=l),label:"Periodo",outlined:"",dense:"",options:i.peridosActivos,rules:[l=>!!l||"Seleccione un periodo"],"emit-value":"","map-options":"","option-label":l=>l.periodo,"option-value":l=>l.id},null,8,["modelValue","options","rules","option-label","option-value"]),n("div",T,[a(d,{color:"negative",label:"Cancelar",onClick:o[3]||(o[3]=l=>i.poaDialog=!1),"no-caps":"",loading:i.loading},null,8,["loading"]),a(d,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:i.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var X=P(Y,[["render",L]]);export{X as default};

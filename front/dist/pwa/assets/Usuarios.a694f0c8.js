import{_ as k,O as n,P as u,Q as r,R as s,S as m,ay as d,U as p,J as g,V as c,az as D,aA as Q,T as w,W as x,a1 as y,aB as U}from"./index.887e7340.js";import{d as N,e as h,f as i,g as b}from"./format.11943369.js";import{Q as G}from"./QBtnDropdown.34d527a5.js";import{Q as v,a as _,b as P}from"./moment.59a6ec3d.js";import{Q as q}from"./QMarkupTable.b4b26b14.js";import{Q as E,a as B}from"./QForm.7e0453cf.js";import{Q as S}from"./QPage.aa820381.js";import{C as V}from"./ClosePopup.84bfd9ea.js";const I={name:"UsuariosPage",data(){return{users:[],user:{},userDialog:!1,loading:!1,actionPeriodo:"",gestiones:[],filter:"",columns:[{name:"actions",label:"Acciones",align:"center"},{name:"name",label:"Nombre",align:"left",field:"name"},{name:"username",label:"Usuario",align:"left",field:"username"},{name:"role",label:"Rol",align:"left",field:"role"},{name:"email",label:"Email",align:"left",field:"email"},{name:"area",label:"Area",align:"left",field:a=>{var l;return(l=a.area)==null?void 0:l.nombre}}],areas:[]}},mounted(){this.usersGet(),this.areasGet()},methods:{areasGet(){this.loading=!0,this.$axios.get("areas").then(a=>{this.areas=a.data}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},userNew(){this.user={name:"",email:"",password:"",area_id:1,username:"",cargo:"",role:"Area"},this.actionPeriodo="Nuevo",this.userDialog=!0},usersGet(){this.loading=!0,this.$axios.get("users").then(a=>{this.users=a.data}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(a=>{this.gestiones=a.data,this.loading=!1}).catch(a=>{this.$alert.error(a.response.data.message),this.loading=!1})},userPost(){this.loading=!0,this.$axios.post("users",this.user).then(a=>{this.usersGet(),this.userDialog=!1,this.$alert.success("Periodo creado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},userPut(){this.loading=!0,this.$axios.put("users/"+this.user.id,this.user).then(a=>{this.usersGet(),this.userDialog=!1,this.$alert.success("Periodo actualizado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},userEditPassword(a){this.user={...a},this.$alert.dialogPrompt("Nueva contrase\xF1a","Ingrese la nueva contrase\xF1a","password").onOk(l=>{this.$axios.put("updatePassword/"+a.id,{password:l}).then(f=>{this.usersGet(),this.$alert.success("Contrase\xF1a actualizada")}).catch(f=>{this.$alert.error(f.response.data.message)})})},userEdit(a){this.user={...a},this.actionPeriodo="Editar",this.userDialog=!0},userDelete(a){this.$alert.dialog("\xBFDesea eliminar el user?").onOk(()=>{this.loading=!0,this.$axios.delete("users/"+a).then(l=>{this.usersGet(),this.$alert.success("Periodo eliminado")}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})})}}},z={class:"text-right"};function A(a,l,f,O,o,t){return n(),u(S,{class:"q-pa-md"},{default:r(()=>[s(_,{rows:o.users,columns:o.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Usuarios",filter:o.filter},{"top-right":r(()=>[s(m,{color:"primary",label:"Nuevo",onClick:t.userNew,outline:"","no-caps":"",icon:"add_circle_outline",loading:o.loading},null,8,["onClick","loading"]),s(d,{modelValue:o.filter,"onUpdate:modelValue":l[0]||(l[0]=e=>o.filter=e),label:"Buscar",dense:"",outlined:""},{append:r(()=>[s(p,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":r(e=>[s(v,{props:e},{default:r(()=>[s(G,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:r(()=>[s(N,null,{default:r(()=>[g((n(),u(h,{clickable:"",onClick:C=>t.userEdit(e.row)},{default:r(()=>[s(i,{avatar:""},{default:r(()=>[s(p,{name:"edit"})]),_:1}),s(i,null,{default:r(()=>[s(b,null,{default:r(()=>l[11]||(l[11]=[c("Editar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]]),g((n(),u(h,{clickable:"",onClick:C=>t.userDelete(e.row.id)},{default:r(()=>[s(i,{avatar:""},{default:r(()=>[s(p,{name:"delete"})]),_:1}),s(i,null,{default:r(()=>[s(b,null,{default:r(()=>l[12]||(l[12]=[c("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]]),g((n(),u(h,{clickable:"",onClick:C=>t.userEditPassword(e.row)},{default:r(()=>[s(i,{avatar:""},{default:r(()=>[s(p,{name:"edit"})]),_:1}),s(i,null,{default:r(()=>[s(b,null,{default:r(()=>l[13]||(l[13]=[c("Cambiar contrase\xF1a")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":r(e=>[s(v,{props:e},{default:r(()=>[s(q,{label:e.row.role,color:a.$filters.colorRole(e.row.role),"text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),s(U,{modelValue:o.userDialog,"onUpdate:modelValue":l[10]||(l[10]=e=>o.userDialog=e),persistent:""},{default:r(()=>[s(D,null,{default:r(()=>[s(Q,{class:"q-pb-none row items-center"},{default:r(()=>[w("div",null,x(o.actionPeriodo)+" user ",1),s(E),s(m,{icon:"close",flat:"",round:"",dense:"",onClick:l[1]||(l[1]=e=>o.userDialog=!1)})]),_:1}),s(Q,{class:"q-pt-none"},{default:r(()=>[s(B,{onSubmit:l[9]||(l[9]=e=>o.user.id?t.userPut():t.userPost())},{default:r(()=>[s(d,{modelValue:o.user.name,"onUpdate:modelValue":l[2]||(l[2]=e=>o.user.name=e),label:"Nombre",dense:"",outlined:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),s(d,{modelValue:o.user.username,"onUpdate:modelValue":l[3]||(l[3]=e=>o.user.username=e),label:"Usuario",dense:"",outlined:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),s(d,{modelValue:o.user.email,"onUpdate:modelValue":l[4]||(l[4]=e=>o.user.email=e),label:"Email",dense:"",outlined:"",hint:""},null,8,["modelValue"]),o.user.id?y("",!0):(n(),u(d,{key:0,modelValue:o.user.password,"onUpdate:modelValue":l[5]||(l[5]=e=>o.user.password=e),label:"Contrase\xF1a",dense:"",outlined:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])),s(P,{modelValue:o.user.role,"onUpdate:modelValue":l[6]||(l[6]=e=>o.user.role=e),label:"Rol",dense:"",outlined:"",options:a.$roles,rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","options","rules"]),s(P,{modelValue:o.user.area_id,"onUpdate:modelValue":l[7]||(l[7]=e=>o.user.area_id=e),label:"Area",dense:"",outlined:"",options:o.areas,rules:[e=>!!e||"Campo requerido"],"emit-value":"","map-options":"","option-label":e=>e.nombre,"option-value":e=>e.id},null,8,["modelValue","options","rules","option-label","option-value"]),w("div",z,[s(m,{color:"negative",label:"Cancelar",onClick:l[8]||(l[8]=e=>o.userDialog=!1),"no-caps":"",loading:o.loading},null,8,["loading"]),s(m,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:o.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var K=k(I,[["render",A]]);export{K as default};
